<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.jsdelivr.net; 
                 script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net;
                 style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
                 img-src 'self' data: https:;
                 connect-src 'self' https://cdn.jsdelivr.net;">
    <title>ARCA - AFIP</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <style>
        .usuario-seleccionado {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #ea40f0;
            padding: 10px;
            font-size: 22px;
            /* <-- más grande el texto */
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;

        }

        /* quiero agrandar mas mucho mas este btn */
        .btn-secundario {
            background: linear-gradient(45deg, #ff6ec4, #7873f5);
            /* degradado colorinche */
            color: white;
            border: none;
            padding: 15px 30px;
            /* más grande */
            border-radius: 10px;
            /* bordes más redondeados */
            cursor: pointer;
            font-size: 16px;
            /* más grande */
            font-weight: bold;
            /* texto más visible */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            /* sombra para resaltar */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-secundario:hover {
            transform: scale(1.05);
            /* efecto de agrandamiento al pasar el mouse */
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
            /* sombra más intensa */
        }

        .menu-principal {
            text-align: center;
            margin: 40px 0;
        }

        .menu-principal .btn-principal {
            margin: 10px;
            padding: 15px 30px;
            font-size: 16px;
        }

        .selector-usuario {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
            background-color: #c5ab7b;
            border-radius: 10px;
            text-align: center;
        }

        .selector-usuario h2 {
            color: #160808;
            margin-bottom: 20px;
        }

        .selector-usuario select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            background-color: #660a70;
        }
    </style>
</head>

<body>
    <div class="general">
        <h1>Sistema AFIP - ARCA</h1>

        <!-- MENÚ PRINCIPAL -->
        <div class="menu-principal">
            <button id="btnEntrarAfip" class="btn-principal">Entrar a AFIP</button>
            <button id="btnUsuarios" class="btn-principal">Gestión de Usuarios</button>
        </div>

        <!-- SELECTOR DE USUARIO -->
        <div id="selectorUsuarioDiv" class="contenido-oculto">
            <div class="selector-usuario">
                <h2>Seleccione el Usuario con el que trabajará</h2>
                <select id="selectUsuariosSelector">
                    <option value="">Cargando usuarios...</option>
                </select>
                <p style="color: #666; font-size: 14px; margin-top: 10px;">
                    Una vez seleccionado el usuario, podrá acceder a los módulos de Facturas y MercadoPago
                </p>
            </div>
        </div>

        <!-- MÓDULOS AFIP (Se muestran después de seleccionar usuario) -->
        <div id="modulosAfipDiv" class="contenido-oculto">
            <!-- Información del usuario seleccionado -->
            <div id="infoUsuarioSeleccionado"></div>

            <!-- SECCIÓN FACTURAS -->
            <div class="seccion">
                <button id="facturasBtn" class="btn-principal">Realizar Facturas</button>
                <div id="facturasDiv" class="contenido-oculto">
                    <h2>Gestión de Facturas</h2>
                    <form id="facturasForm">
                        <div id="selectUsuariosDiv">
                            <label for="selectUsuarios">Usuario Activo:</label>
                            <select id="selectUsuarios" disabled>
                                <option value="">Usuario se establecerá automáticamente</option>
                            </select>
                        </div>
                        <div id="tipoActividadDiv">
                            <h2>Tipo de Actividad</h2>
                            <div>
                                <input type="radio" name="Actividad" value="Producto" id="producto">
                                <label for="producto">Producto</label>
                            </div>
                            <div>
                                <input type="radio" name="Actividad" value="Servicio" id="servicio">
                                <label for="servicio">Servicio</label>
                            </div>
                        </div>
                        <div id="periodoAFacturarDiv">
                            <h2>Periodo a Facturar</h2>

                            <div id="fechaDelComprobante" style="display: block;">
                                <h3>Seleccionar Fecha Del Comprobante</h3>
                                <input type="text" id="fechaComprobante" name="fechaComprobante"
                                    placeholder="Selecciona un día">
                            </div>

                            <div>
                                <h3>Seleccionar método de ingreso de datos</h3>
                                <label>
                                    <input type="radio" name="metodoIngreso" value="manual" id="ingresoManual" checked>
                                    Ingreso manual
                                </label>
                                <label>
                                    <input type="radio" name="metodoIngreso" value="masivo" id="ingresoMasivo">
                                    Carga masiva de datos
                                </label>
                            </div>
                            <div id="seccionManual">
                                <div class="periodo-selects">
                                    <div>
                                        <label for="selectMes">Mes:</label>
                                        <select name="mes" id="selectMes"></select>
                                    </div>
                                    <div>
                                        <label for="selectAnio">Año:</label>
                                        <select name="anio" id="selectAnio"></select>
                                    </div>
                                </div>
                                <!-- crear un div con el titulo "Preseleccion de fechas que abarque a los tres name="periodoFacturacion" " -->
                                <div>
                                    <p>Preselección de fechas</p>
                                    <div>
                                        <input type="radio" name="periodoFacturacion" value="total" id="periodoTotal">
                                        <label for="periodoTotal">Mensual Total</label>
                                        <label for="">Este periodo abarca la totalidad de dias del mes</label>
                                    </div>
                                    <div>
                                        <input type="radio" name="periodoFacturacion" value="habiles"
                                            id="periodoDiasHabiles">
                                        <label for="periodoDiasHabiles">Días Hábiles</label>
                                    </div>
                                    <div>
                                        <input type="radio" name="periodoFacturacion" value="manual" id="periodoManual">
                                        <label for="periodoManual">Ingreso de días manual</label>
                                        <br>
                                        <div id="calendario" style="display: none;">
                                            <input type="text" id="datepicker" placeholder="Selecciona días">
                                        </div>
                                        <textarea name="fechasFacturas" id="fechasFacturas"></textarea>
                                    </div>
                                </div>
                                <div id="montoAFacturarDiv">
                                    <h2>Total a facturar</h2>
                                    <div>
                                        <input type="radio" name="tipoMonto" value="montoTotal" id="montoTotal">
                                        <label for="montoTotal">Ingresar un monto total de facturación</label>
                                        <div id="inputContainerTotal" style="display: none;">
                                            <br>
                                            Ingrese el monto a facturar:
                                            <input type="number" id="montoTotalInput" name="montoTotalInput"
                                                placeholder="Monto Total" />
                                        </div>
                                    </div>
                                    <div>
                                        <input type="radio" name="tipoMonto" value="montoManual" id="montoManual">
                                        <label for="montoManual">Ingresar manualmente el monto a facturar</label>
                                        <div id="textareaContainer" style="display: none;">
                                            <br>
                                            Ingrese los montos a facturar separados por comas:
                                            <textarea name="montoManual" id="textareaMontoManual"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="seccionMasiva" style="display: none;">
                                <h4>Ingreso masivo de datos</h4>
                                <label for="textareaFechas">Fechas (una por línea):</label>
                                <textarea id="textareaFechas" rows="10" cols="30" placeholder="DD/MM/YYYY"></textarea>
                                <br>
                                <label for="textareaMontos">Montos (uno por línea):</label>
                                <textarea id="textareaMontos" rows="10" cols="30"
                                    placeholder="Monto correspondiente a cada fecha"></textarea>
                                <br>
                                <button id="procesarDatos">Procesar datos</button>
                                <div id="resultadoProcesamiento" style="margin-top: 20px; display: none;">
                                    <h4>Datos procesados:</h4>
                                    <table border="1">
                                        <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Monto</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tablaDatosProcesados"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <button id="procesarFacturas" type="submit">Procesar </button>
                    </form>
                    <div id="respuesta">
                        <textarea id="codigoLocalStorage"
                            style="display: none; width: 100%; height: 200px; resize: vertical;"></textarea>
                        <button id="copiarCodigo" style="display: none;">Copiar Código</button>
                    </div>
                    <div id="ejecutaNavegador">
                        <!--
                        <button id="testButton">Abrir AFIP en Modo Test</button>
                        <button id="loginButton">Abrir AFIP con Puppeteer</button>
                        -->
                    </div>
                    <div class="container">
                        <div id="hacerFacturaFacturas" class="hacerFacturaFacturas hidden">
                            <button id="habilitarBtnAFIP" class="btn-principal">Hacer Facturas</button>
                        </div>
                        <div id="botones-puppeteer" class="botones-puppeteer">
                            <div class="auth-options">
                                <h3>Selecciona el modo de Ingreso:</h3>
                                <button id="testButton" class="btn-test">
                                    🧪 Abrir AFIP - Modo Test
                                </button>
                                <button id="loginButton" class="btn-login">
                                    🔐 Abrir AFIP - Modo Producción
                                </button>
                                <div class="info-container">
                                    <p><strong>Modo Test:</strong> Para pruebas y desarrollo</p>
                                    <p><strong>Modo Producción:</strong> Para facturación real</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN MERCADO PAGO -->
            <div class="seccion">
                <button id="btnLectorMP" class="btn-principal">Lector MercadoPago</button>
                <div id="leerMercadoPagoDiv" class="contenido-oculto">
                    <!-- El contenido se cargará dinámicamente -->
                </div>
            </div>

            <!-- SECCIÓN LIBRO IVA -->
            <div class="seccion">
                <button id="btnLibroIVA" class="btn-principal">Libro IVA</button>
                <div id="libroIvaDiv" class="contenido-oculto">
                    <h2>Gestión de Libro IVA</h2>
                    <form id="libroIvaForm">
                        <div id="informeDiv">
                            <input type="radio" name="case" value="informe" id="informe" required>
                            <label for="informe">Analizar el libro IVA</label>
                        </div>

                        <div id="eliminarAnterioresDiv">
                            <input type="radio" name="case" value="eliminarAnteriores" id="eliminarAnteriores">
                            <label for="eliminarAnteriores">Eliminar anteriores</label>
                        </div>

                        <div>
                            <input type="radio" name="case" value="todoAnterior" id="todoAnterior" required>
                            <label for="todoAnterior">Todo lo anterior</label>
                        </div>

                        <button type="button"
                            id="seleccionarArch                                                                                                     ivoComprobanteBtn">Seleccionar
                            Archivo de
                            Comprobante</button>
                        <div id="archivoComprobanteSeleccionado">
                            <p>Archivo de Comprobante seleccionado:</p>
                            <p id="nombreArchivoComprobante"></p>
                            <p id="rutaArchivoComprobante"></p>
                        </div>

                        <button type="button" id="seleccionarArchivoAlicuotasBtn">Seleccionar Archivo de
                            Alícuotas</button>
                        <div id="archivoAlicuotasSeleccionado">
                            <p>Archivo de Alícuotas seleccionado:</p>
                            <p id="nombreArchivoAlicuotas"></p>
                            <p id="rutaArchivoAlicuotas"></p>
                        </div>

                        <button type="submit" id="procesarLibroIvaBtn">Procesar Libro IVA</button>

                        <div id="lineasExcedidas"></div>
                        <button id="btnEditarLineasExcedidas" style="display: none;">Editar Línea Excedida</button>
                    </form>

                    <div id="resultado"></div>

                    <div id="modificarSegunInformeDiv" style="display: none;">
                        <button type="button" id="modificarSegunInforme">Modificar según el informe el libro</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCIÓN USUARIOS -->
        <div id="usuariosDiv" class="contenido-oculto">
            <!-- El contenido se cargará dinámicamente -->
        </div>

        <!-- MODAL DE EDICIÓN -->
        <div id="modalEdicion" style="display: none; position: fixed; top: 50%; left: 50%;
             transform: translate(-50%, -50%); background: white; border: 1px solid #ccc; 
             padding: 1em; z-index: 1000; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h3>Editar Línea Excedida</h3>
            <p id="modalMensaje"></p>
            <textarea id="txtLineaEdicion" rows="5" cols="60"></textarea>
            <br><br>
            <button id="btnGuardarEdicion">Guardar</button>
            <button id="btnCerrarModal">Cerrar</button>
        </div>

        <!-- Fondo del modal -->
        <div id="modalFondo" style="display: none; position: fixed; top: 0; left: 0;
             width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900;"></div>
    </div>

    <script type="module" src="../controlador.js"></script>
    <script src="script.js"></script>
</body>

</html>